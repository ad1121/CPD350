<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Minhas Finan√ßas</title>

<!-- üìå Biblioteca para o gr√°fico -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
        background:white;
        color:black;
        font-family: Arial, sans-serif;
        padding: 20px;
        max-width: 900px;
        margin: auto;
        animation: fadeIn 0.5s ease-in-out;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .saldo-container {
        text-align: center;
        padding: 30px;
        margin-bottom: 30px;
        border: 2px solid black;
        border-radius: 8px;
        transition: transform .3s;
    }

    .saldo-container:hover {
        transform: scale(1.02);
    }

    .saldo-valor { font-size: 48px; font-weight: bold; }
    .saldo-negativo { color:red; }
    .saldo-positivo { color:black; }

    .secao { margin-bottom: 40px; animation: fadeIn 0.6s ease; }

    h2 {
        margin-bottom: 10px;
        border-bottom: 2px solid black;
        padding-bottom: 8px;
        animation: slideIn .5s ease;
    }

    @keyframes slideIn {
        from { transform: translateX(-20px); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }

    .formulario { display: flex; gap: 10px; flex-wrap: wrap; }

    input {
        padding: 8px;
        border: 1px solid black;
        border-radius: 4px;
        font-size: 14px;
        transition: transform .2s;
    }

    input:focus {
        transform: scale(1.02);
        outline:2px solid black;
    }

    input.valor-input { text-align:right; }

    button {
        padding: 8px 14px;
        background:black;
        color:white;
        border:none;
        border-radius:4px;
        cursor:pointer;
        transition: background .2s, transform .2s;
    }

    button:hover {
        background:#333;
        transform: scale(1.05);
    }

    .lista {
        border:1px solid black;
        border-radius:4px;
        min-height:80px;
        overflow:hidden;
    }

    .item {
        display:flex;
        justify-content:space-between;
        padding:12px;
        border-bottom:1px solid #ddd;
        align-items:center;
        animation: fadeIn .3s ease;
    }

    .item:last-child { border-bottom:none; }

    .item-paga { opacity: .5; text-decoration: line-through; }

    .btn-pagar { background:#e74c3c; }
    .btn-desfazer { background:#3498db; }

    .lista-vazia { text-align:center; padding:20px; color:#666; }

    /* √Årea do GR√ÅFICO */
    .grafico-container {
        margin-top: 40px;
        padding:20px;
        border:2px solid black;
        border-radius:8px;
        animation: fadeIn 0.8s ease;
    }
</style>
</head>

<body>

<div class="saldo-container">
    <div>SALDO ATUAL</div>
    <div id="saldo" class="saldo-valor saldo-positivo">R$ 0,00</div>
</div>



<!-- RECEITAS -->
<div class="secao">
    <h2>üí∞ Receitas</h2>
    <div class="formulario">
        <input type="text" id="receita-descricao" placeholder="Descri√ß√£o">
        <input type="text" id="receita-valor" class="valor-input" inputmode="numeric" placeholder="0,00">
        <button onclick="adicionarReceita()">+ Adicionar</button>
    </div>
    <div class="lista" id="lista-receitas">
        <div class="lista-vazia">Nenhuma receita adicionada</div>
    </div>
</div>



<!-- DESPESAS -->
<div class="secao">
    <h2>üí∏ Despesas</h2>
    <div class="formulario">
        <input type="text" id="despesa-descricao" placeholder="Descri√ß√£o">
        <input type="text" id="despesa-valor" class="valor-input" inputmode="numeric" placeholder="0,00">
        <button onclick="adicionarDespesa()">+ Adicionar</button>
    </div>
    <div class="lista" id="lista-despesas">
        <div class="lista-vazia">Nenhuma despesa adicionada</div>
    </div>
</div>



<!-- GR√ÅFICO PIZZA -->
<div class="grafico-container">
    <h2>üìä Distribui√ß√£o: Receitas x Despesas Pagas</h2>
    <canvas id="pizzaGrafico"></canvas>
</div>



<script>
    let receitas = JSON.parse(localStorage.getItem("receitas")) || [];
    let despesas = JSON.parse(localStorage.getItem("despesas")) || [];

    function salvar() {
        localStorage.setItem("receitas", JSON.stringify(receitas));
        localStorage.setItem("despesas", JSON.stringify(despesas));
    }

    function formatarMoeda(valor) {
        return valor.toLocaleString("pt-BR", { style:"currency", currency:"BRL" });
    }

    function formatarValorInput(v) {
        const n = v.replace(/\D/g, "");
        if (!n) return "";
        return (parseInt(n) / 100).toLocaleString("pt-BR", { minimumFractionDigits: 2 });
    }

    function converterParaNumero(v) {
        return parseFloat(v.replace(/\./g,"").replace(",","."));
    }

    document.querySelectorAll(".valor-input").forEach(input => {
        input.addEventListener("input", e => {
            e.target.value = formatarValorInput(e.target.value);
        });

        input.addEventListener("keypress", e => {
            if (e.key < "0" || e.key > "9") e.preventDefault();
        });
    });

    function calcularSaldo() {
        const totalReceitas = receitas.reduce((s,r)=>s+r.valor,0);
        const totalDespesasPagas = despesas.filter(d=>d.paga).reduce((s,d)=>s+d.valor,0);
        return totalReceitas - totalDespesasPagas;
    }

    function atualizarSaldo() {
        const saldo = calcularSaldo();
        const el = document.getElementById("saldo");
        el.textContent = formatarMoeda(saldo);
        el.className = "saldo-valor " + (saldo < 0 ? "saldo-negativo" : "saldo-positivo");
    }

    function adicionarReceita() {
        const desc = document.getElementById("receita-descricao").value;
        const val = document.getElementById("receita-valor").value;
        if (!desc || !val) return alert("Preencha descri√ß√£o e valor");

        receitas.push({ id:Date.now(), descricao:desc, valor:converterParaNumero(val) });
        salvar();
        renderizarReceitas();
        atualizarSaldo();
        atualizarGrafico();

        document.getElementById("receita-descricao").value="";
        document.getElementById("receita-valor").value="";
    }

    function adicionarDespesa() {
        const desc = document.getElementById("despesa-descricao").value;
        const val = document.getElementById("despesa-valor").value;
        if (!desc || !val) return alert("Preencha descri√ß√£o e valor");

        despesas.push({ id:Date.now(), descricao:desc, valor:converterParaNumero(val), paga:false });
        salvar();
        renderizarDespesas();
        atualizarSaldo();
        atualizarGrafico();

        document.getElementById("despesa-descricao").value="";
        document.getElementById("despesa-valor").value="";
    }

    function pagarDespesa(id) {
        const d = despesas.find(x=>x.id===id);
        d.paga = true;
        salvar();
        renderizarDespesas();
        atualizarSaldo();
        atualizarGrafico();
    }

    function desfazerPagamento(id) {
        const d = despesas.find(x=>x.id===id);
        d.paga = false;
        salvar();
        renderizarDespesas();
        atualizarSaldo();
        atualizarGrafico();
    }

    function renderizarReceitas() {
        const lista = document.getElementById("lista-receitas");

        if (receitas.length === 0) {
            lista.innerHTML = '<div class="lista-vazia">Nenhuma receita adicionada</div>';
            return;
        }

        lista.innerHTML = receitas.map(r=>`
            <div class="item">
                <div>
                    <div><b>${r.descricao}</b></div>
                    <div>${formatarMoeda(r.valor)}</div>
                </div>
            </div>
        `).join("");
    }

    function renderizarDespesas() {
        const lista = document.getElementById("lista-despesas");

        if (despesas.length === 0) {
            lista.innerHTML = '<div class="lista-vazia">Nenhuma despesa adicionada</div>';
            return;
        }

        lista.innerHTML = despesas.map(d=>`
            <div class="item ${d.paga ? "item-paga" : ""}">
                <div>
                    <div><b>${d.descricao}</b></div>
                    <div>${formatarMoeda(d.valor)}</div>
                </div>

                ${d.paga 
                    ? `<button class="btn-desfazer" onclick="desfazerPagamento(${d.id})">Desfazer</button>`
                    : `<button class="btn-pagar" onclick="pagarDespesa(${d.id})">Pagar</button>`}
            </div>
        `).join("");
    }

    // ---------- GR√ÅFICO PIZZA ----------
    let pizzaGrafico = null;

    function atualizarGrafico() {
        const totalReceitas = receitas.reduce((s,r)=>s+r.valor,0);
        const totalDespesasPagas = despesas.filter(x=>x.paga).reduce((s,d)=>s+d.valor,0);

        if (pizzaGrafico) pizzaGrafico.destroy();

        const ctx = document.getElementById("pizzaGrafico").getContext("2d");

        pizzaGrafico = new Chart(ctx, {
            type: "pie",
            data: {
                labels: ["Receitas", "Despesas Pagas"],
                datasets: [{
                    data: [totalReceitas, totalDespesasPagas],
                    backgroundColor: ["#2ecc71", "#e74c3c"]
                }]
            },
            options: { responsive: true }
        });
    }

    renderizarReceitas();
    renderizarDespesas();
    atualizarSaldo();
    atualizarGrafico();
</script>

</body>
</html>