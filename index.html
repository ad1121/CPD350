<!DOCTYPE html>

<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Controle Financeiro</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root{
    --primaria: #FF3B5C;
    --secundaria: #FFB400;
    --sucesso: #2ECC71;
    --fundo: #F6F7FB;
    --texto: #222;
    --card-bg: #ffffff;
}
*{box-sizing:border-box;margin:0;padding:0}
body{
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background:var(--fundo);
    color:var(--texto);
    padding:18px;
    -webkit-font-smoothing:antialiased;
}
.header{
    background: linear-gradient(90deg,var(--primaria), #ff6b84);
    color:white;
    padding:18px;
    border-radius:12px;
    text-align:center;
    font-weight:700;
    font-size:20px;
    box-shadow:0 6px 18px rgba(0,0,0,0.08);
    margin-bottom:18px;
    animation:fadeInDown .45s ease;
}
.main{
    display:grid;
    grid-template-columns: 1fr 380px;
    gap:18px;
}
@media(max-width:920px){
    .main{ grid-template-columns: 1fr; }
}
.card{
    background:var(--card-bg);
    border-radius:12px;
    padding:14px;
    box-shadow:0 6px 18px rgba(8,8,8,0.06);
    animation:fadeInUp .45s ease;
}
.resumo{
    display:flex;
    justify-content:space-between;
    gap:10px;
    padding:16px;
    border-radius:10px;
    background:linear-gradient(180deg, rgba(255,255,255,0.35), rgba(255,255,255,0));
    align-items:center;
    flex-wrap:wrap;
}
.resumo .box{ text-align:center; flex:1; min-width:100px; }
.resumo .box small{ display:block; color:#666; font-size:12px; margin-bottom:6px; }
.resumo .box .num{ font-weight:800; font-size:18px; }
.resumo .box .num.neg{ color: #e74c3c; }
.form-row{
    display:flex;
    gap:10px;
    margin-bottom:12px;
    flex-wrap:wrap;
}
.form-row input[type="text"]{
    flex:1;
    padding:10px 12px;
    border-radius:8px;
    border:1px solid rgba(0,0,0,0.08);
    font-size:14px;
    background: #fff;
}
.form-row input.valor-input{
    width:150px;
    text-align:right;
}
.form-row button{
    padding:10px 14px;
    border-radius:8px;
    border:none;
    cursor:pointer;
    font-weight:700;
}
.btn-add-receita{ background: linear-gradient(90deg,var(--sucesso), #22b66a); color:white }
.btn-add-despesa{ background: linear-gradient(90deg,var(--primaria), #ff6b84); color:white }
.lista{
    margin-top:8px;
    display:flex;
    flex-direction:column;
    gap:10px;
}
.item{
    display:flex;
    justify-content:space-between;
    align-items:center;
    background: #fff;
    padding:12px;
    border-radius:10px;
    box-shadow:0 4px 10px rgba(0,0,0,0.04);
    transition: transform .12s ease, box-shadow .12s ease;
}
.item:hover{ transform: translateY(-4px); box-shadow:0 10px 20px rgba(0,0,0,0.06); }
.item .meta{
    display:flex;
    flex-direction:column;
    gap:4px;
}
.item .descricao{
    font-weight:700;
    color:#222;
}
.item .sub{
    font-size:13px;
    color:#666;
}
.item .valor{
    font-weight:800;
    min-width:110px;
    text-align:right;
    color:var(--primaria);
}
.item.paga .valor{ color: #999 }
.item.paga{ opacity:.6; text-decoration: line-through; }
.item .acoes{
    display:flex;
    gap:8px;
    margin-left:12px;
}
.btn-pagar{
    background:var(--primaria);
    color:white;
    border:none;
    padding:8px 10px;
    border-radius:8px;
    cursor:pointer;
    font-weight:700;
}
.btn-desfazer{
    background:var(--secundaria);
    color:#222;
    border:none;
    padding:8px 10px;
    border-radius:8px;
    cursor:pointer;
    font-weight:700;
}
.btn-remover{
    background:transparent;
    border:1px solid rgba(0,0,0,0.06);
    color:#777;
    padding:8px 10px;
    border-radius:8px;
    cursor:pointer;
    font-weight:700;
}
.aside {
    display:flex;
    flex-direction:column;
    gap:12px;
}
.grafico-card{ padding:14px; border-radius:10px; background:#fff; }
canvas{ width:100% !important; height:260px !important; }
.rodape{
    margin-top:12px;
    font-size:13px;
    color:#666;
    text-align:center;
}
@keyframes fadeInUp { from{opacity:0; transform:translateY(8px)} to{opacity:1; transform:none} }
@keyframes fadeInDown { from{opacity:0; transform:translateY(-8px)} to{opacity:1; transform:none} }
</style>
</head>
<body>
<div class="header">Controle Financeiro</div>
<div class="main">
    <div class="card">
        <div class="resumo" style="margin-bottom:12px">
            <div class="box">
                <small>Total Receitas</small>
                <div id="totalReceitas" class="num">R$ 0,00</div>
            </div>
            <div class="box">
                <small>Total Despesas</small>
                <div id="totalDespesas" class="num">R$ 0,00</div>
            </div>
            <div class="box">
                <small>Despesas Pendentes</small>
                <div id="totalDespesasPendentes" class="num">R$ 0,00</div>
            </div>
            <div class="box">
                <small>Saldo Atual</small>
                <div id="saldoValor" class="num">R$ 0,00</div>
            </div>
        </div>
        <div style="margin-bottom:10px">
            <strong>Adicionar Receita</strong>
            <div class="form-row" style="margin-top:8px">
                <input id="rec-desc" type="text" placeholder="Descrição (ex: Salário)" />
                <input id="rec-valor" type="text" class="valor-input" placeholder="0,00" inputmode="numeric" />
                <button class="btn-add-receita" onclick="adicionarReceita()">Adicionar</button>
            </div>
        </div>
        <div>
            <strong>Receitas</strong>
            <div id="lista-receitas" class="lista" style="margin-top:8px">
                <div style="padding:12px;color:#666;background:#fff;border-radius:10px">Nenhuma receita</div>
            </div>
        </div>
        <hr style="margin:16px 0;border:none;border-top:1px dashed rgba(0,0,0,0.06)"/>
        <div style="margin-bottom:10px">
            <strong>Adicionar Despesa</strong>
            <div class="form-row" style="margin-top:8px">
                <input id="des-desc" type="text" placeholder="Descrição (ex: Almoço)" />
                <input id="des-valor" type="text" class="valor-input" placeholder="0,00" inputmode="numeric" />
                <button class="btn-add-despesa" onclick="adicionarDespesa()">Adicionar</button>
            </div>
        </div>
        <div>
            <strong>Despesas</strong>
            <div id="lista-despesas" class="lista" style="margin-top:8px">
                <div style="padding:12px;color:#666;background:#fff;border-radius:10px">Nenhuma despesa</div>
            </div>
        </div>
        <div class="rodape">Os lançamentos ficam salvos no seu navegador (localStorage).</div>
    </div>
    <aside class="aside">
        <div class="grafico-card card">
            <strong style="display:block;margin-bottom:10px">Distribuição</strong>
            <canvas id="pizzaGrafico"></canvas>
        </div>
        <div class="card">
            <strong>Atalhos</strong>
            <div style="display:flex;gap:8px;margin-top:10px">
                <button onclick="limparTudo()" style="flex:1;padding:10px;border-radius:8px;border:none;background:#eee;font-weight:700;cursor:pointer">Limpar Tudo</button>
                <button onclick="exportarJSON()" style="flex:1;padding:10px;border-radius:8px;border:none;background:var(--primaria);color:#fff;font-weight:700;cursor:pointer">Exportar</button>
            </div>
        </div>
    </aside>
</div>
<script>
let receitas = JSON.parse(localStorage.getItem('minhas_receitas_v1')) || [];
let despesas = JSON.parse(localStorage.getItem('minhas_despesas_v1')) || [];
function salvar(){
    localStorage.setItem('minhas_receitas_v1', JSON.stringify(receitas));
    localStorage.setItem('minhas_despesas_v1', JSON.stringify(despesas));
}
function formatarMoeda(num){
    return num.toLocaleString('pt-BR', { style:'currency', currency:'BRL' });
}
function formatarInputValor(text){
    const onlyNums = text.replace(/\D/g,'');
    if(!onlyNums) return '';
    const n = parseInt(onlyNums,10);
    return (n/100).toLocaleString('pt-BR', { minimumFractionDigits:2, maximumFractionDigits:2 });
}
function strToNumber(formatted){
    if(!formatted) return 0;
    return parseFloat(formatted.replace(/\./g,'').replace(',','.')) || 0;
}
const elRecDesc = document.getElementById('rec-desc');
const elRecVal = document.getElementById('rec-valor');
const elDesDesc = document.getElementById('des-desc');
const elDesVal = document.getElementById('des-valor');
const elListaReceitas = document.getElementById('lista-receitas');
const elListaDespesas = document.getElementById('lista-despesas');
const elSaldoValor = document.getElementById('saldoValor');
const elTotalReceitas = document.getElementById('totalReceitas');
const elTotalDespesas = document.getElementById('totalDespesas');
const elTotalDespesasPendentes = document.getElementById('totalDespesasPendentes');
[elRecVal, elDesVal].forEach(inp=>{
    inp.addEventListener('input', e=>{
        e.target.value = formatarInputValor(e.target.value);
        e.target.selectionStart = e.target.selectionEnd = e.target.value.length;
    });
    inp.addEventListener('keypress', e=>{
        if(e.key === 'Enter'){
            if(inp.id === 'rec-valor'){ adicionarReceita(); } else { adicionarDespesa(); }
            e.preventDefault();
            return;
        }
        if(e.key < '0' || e.key > '9') e.preventDefault();
    });
});
function calcularTotais(){
    const totalReceitas = receitas.reduce((s,r)=>s + r.valor, 0);
    const totalDespesas = despesas.reduce((s,d)=>s + d.valor, 0);
    const totalDespesasPagas = despesas.filter(d=>d.paga).reduce((s,d)=>s + d.valor, 0);
    const totalDespesasPendentes = despesas.filter(d=>!d.paga).reduce((s,d)=>s + d.valor, 0);
    return { totalReceitas, totalDespesas, totalDespesasPagas, totalDespesasPendentes };
}
function atualizarSaldo(){
    const { totalReceitas, totalDespesas, totalDespesasPagas, totalDespesasPendentes } = calcularTotais();
    const saldo = totalReceitas - totalDespesasPagas;
    elSaldoValor.textContent = formatarMoeda(saldo);
    if(saldo < 0) elSaldoValor.classList.add('neg'); else elSaldoValor.classList.remove('neg');
    elTotalReceitas.textContent = formatarMoeda(totalReceitas);
    elTotalDespesas.textContent = formatarMoeda(totalDespesas);
    elTotalDespesasPendentes.textContent = formatarMoeda(totalDespesasPendentes);
}
function renderizarReceitas(){
    if(receitas.length === 0){
        elListaReceitas.innerHTML = '<div style="padding:12px;color:#666;background:#fff;border-radius:10px">Nenhuma receita</div>';
        return;
    }
    elListaReceitas.innerHTML = receitas.map(r => `
        <div class="item" id="rec-${r.id}">
            <div class="meta">
                <div class="descricao">${escapeHtml(r.descricao)}</div>
            </div>
            <div style="display:flex;align-items:center;gap:10px">
                <div class="valor">${formatarMoeda(r.valor)}</div>
                <div class="acoes">
                    <button class="btn-remover" onclick="removerReceita(${r.id})" title="Remover">Rem</button>
                </div>
            </div>
        </div>
    `).join('');
}
function renderizarDespesas(){
    if(despesas.length === 0){
        elListaDespesas.innerHTML = '<div style="padding:12px;color:#666;background:#fff;border-radius:10px">Nenhuma despesa</div>';
        return;
    }
    elListaDespesas.innerHTML = despesas.map(d => `
        <div class="item ${d.paga ? 'paga' : ''}" id="des-${d.id}">
            <div class="meta">
                <div class="descricao">${escapeHtml(d.descricao)}</div>
            </div>
            <div style="display:flex;align-items:center;gap:10px">
                <div class="valor">${formatarMoeda(d.valor)}</div>
                <div class="acoes">
                    ${d.paga 
                        ? `<button class="btn-desfazer" onclick="desfazerPagamento(${d.id})">Desfazer</button>`
                        : `<button class="btn-pagar" onclick="pagarDespesa(${d.id})">Pagar</button>`
                    }
                    <button class="btn-remover" onclick="removerDespesa(${d.id})">Rem</button>
                </div>
            </div>
        </div>
    `).join('');
}
function adicionarReceita(){
    const desc = elRecDesc.value.trim();
    const rawVal = elRecVal.value.trim();
    const valor = strToNumber(rawVal);
    if(!desc || valor <= 0){
        alert('Preencha descrição e um valor válido para a receita.');
        return;
    }
    const item = { id: Date.now(), descricao: desc, valor };
    receitas.unshift(item);
    salvar();
    elRecDesc.value = '';
    elRecVal.value = '';
    renderizarReceitas();
    atualizarSaldo();
    atualizarGrafico();
}
function adicionarDespesa(){
    const desc = elDesDesc.value.trim();
    const rawVal = elDesVal.value.trim();
    const valor = strToNumber(rawVal);
    if(!desc || valor <= 0){
        alert('Preencha descrição e um valor válido para a despesa.');
        return;
    }
    const item = { id: Date.now(), descricao: desc, valor, paga:false };
    despesas.unshift(item);
    salvar();
    elDesDesc.value = '';
    elDesVal.value = '';
    renderizarDespesas();
    atualizarSaldo();
    atualizarGrafico();
}
function pagarDespesa(id){
    const d = despesas.find(x=>x.id === id);
    if(!d) return;
    d.paga = true;
    salvar();
    renderizarDespesas();
    atualizarSaldo();
    atualizarGrafico();
}
function desfazerPagamento(id){
    const d = despesas.find(x=>x.id === id);
    if(!d) return;
    d.paga = false;
    salvar();
    renderizarDespesas();
    atualizarSaldo();
    atualizarGrafico();
}
function removerReceita(id){
    if(!confirm('Remover esta receita?')) return;
    receitas = receitas.filter(r=> r.id !== id);
    salvar();
    renderizarReceitas();
    atualizarSaldo();
    atualizarGrafico();
}
function removerDespesa(id){
    if(!confirm('Remover esta despesa?')) return;
    despesas = despesas.filter(d=> d.id !== id);
    salvar();
    renderizarDespesas();
    atualizarSaldo();
    atualizarGrafico();
}
function exportarJSON(){
    const data = { receitas, despesas, exportadoEm: new Date().toISOString() };
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `controle_financeiro_${new Date().toISOString().slice(0,10)}.json`;
    a.click();
    URL.revokeObjectURL(url);
}
function limparTudo(){
    if(!confirm('Apagar todas as receitas e despesas?')) return;
    receitas = [];
    despesas = [];
    salvar();
    renderizarReceitas();
    renderizarDespesas();
    atualizarSaldo();
    atualizarGrafico();
}
function escapeHtml(str){
    return String(str)
        .replace(/&/g,'&amp;')
        .replace(/</g,'&lt;')
        .replace(/>/g,'&gt;')
        .replace(/"/g,'&quot;')
        .replace(/'/g,'&#39;');
}
let pizzaGrafico = null;
function atualizarGrafico(){
    const totalReceitas = receitas.reduce((s,r)=>s + r.valor, 0);
    const totalDespesasPagas = despesas.filter(d=>d.paga).reduce((s,d)=>s + d.valor, 0);
    const ctx = document.getElementById('pizzaGrafico').getContext('2d');
    const data = {
        labels: ['Receitas', 'Despesas Pagas'],
        datasets: [{
            data: [totalReceitas, totalDespesasPagas],
            backgroundColor: [ 'rgba(46,204,113,0.95)', 'rgba(255,59,92,0.95)' ],
            hoverOffset:8,
            borderRadius:4
        }]
    };
    const options = {
        plugins: {
            legend: { position: 'bottom' },
            tooltip: { callbacks: {
                label: ctx => `${ctx.label}: ${formatarMoeda(ctx.raw)}`
            } }
        },
        maintainAspectRatio: false,
        responsive: true
    };
    if(pizzaGrafico) pizzaGrafico.destroy();
    pizzaGrafico = new Chart(ctx, { type: 'pie', data, options });
}
function inicializar(){
    renderizarReceitas();
    renderizarDespesas();
    atualizarSaldo();
    atualizarGrafico();
}
inicializar();
</script>
</body>
</html>